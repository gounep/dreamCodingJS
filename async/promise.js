/*
Promise
- JSì—ì„œ ì œê³µí•˜ëŠ” ë¹„ë™ê¸°ë¥¼ ê°„í¸í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” object
- ì •í•´ì§„ ì¥ì‹œê°„ì˜ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ê³  ë‚˜ì„œ ì •ìƒì ìœ¼ë¡œ ê¸°ëŠ¥ì´ ìˆ˜í–‰ë˜ì—ˆë‹¤ë©´ ì„±ê³µì˜ ë©”ì‹œì§€ì™€ í•¨ê»˜ ì²˜ë¦¬ëœ ê²°ê³¼ê°’ì„ ì „ë‹¬í•´ì£¼ê³ ,
- ë§Œì•½ ê¸°ëŠ¥ ìˆ˜í–‰ ì¤‘ ì˜ˆìƒì¹˜ ëª»í•œ ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ì—ëŸ¬ë¥¼ ì „ë‹¬í•´ì¤€ë‹¤

ì˜ˆì‹œ) pre-enrollment
ë“œë¦¼ì½”ë”© ì•„ì¹´ë°ë¯¸ì—ì„œ ì½”ìŠ¤ë¥¼ ì¤€ë¹„ì¤‘ì¸ë° ì–¸ì œ ì½”ìŠ¤ê°€ ì™„ë£Œë ì§€ ëª¨ë¥´ëŠ” ì‹œì ì´ë‹¤
ê´€ì‹¬ìˆëŠ” í•™ìƒë“¤ì€ ì´ë©”ì¼ì„ í†µí•´ ë¯¸ë¦¬ ë“±ë¡í•  ìˆ˜ ìˆëŠ” ì‹œìŠ¤í…œì´ ìˆë‹¤(Promise ìƒì„±)
Aí•™ìƒì´ ë“±ë¡ì„ ì™„ë£Œí•˜ê²Œ ë˜ë©´(Promiseì— ë“±ë¡), ì‹œê°„ì´ ì§€ë‚œ í›„ì— ì½”ìŠ¤ê°€ ì˜¤í”ˆì´ ë˜ë©´
Aí•™ìƒì—ê²Œ ë©”ì¼ë¡œ ê³µì§€ê°€ ì˜¨ë‹¤. ìˆ˜ì—… ì¤€ë¹„ì „ ë¯¸ë¦¬ ë“±ë¡í–ˆìœ¼ë¯€ë¡œ ìˆ˜ì—…ì™„ë£Œë˜ìë§ˆì ê³µì§€ë¥¼ ë°›ìŒ(Promiseê°€ ì„±ê³µì ìœ¼ë¡œ ê°’ì„ ì „ë‹¬í•¨)
ìˆ˜ì—…ì´ ì´ë¯¸ ì˜¤í”ˆëœ í›„ì— Bí•™ìƒì´ ì‚¬ì „ ê³µì§€ì°½ì„ ë°œê²¬í•´ì„œ ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥í•˜ê³  ë“±ë¡í•˜ë©´, ìˆ˜ì—…ì´ ì´ë¯¸ ì˜¤í”ˆë˜ì—ˆìœ¼ë¯€ë¡œ
ê¸°ë‹¤ë¦´ í•„ìš”ê°€ ì—†ì´ ë°”ë¡œ Bì—ê²Œ ê³µì§€ê°€ ì˜¤ê³  ìˆ˜ì—…ì— ì°¸ì—¬í•  ìˆ˜ ìˆë‹¤.(ì´ë¯¸ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ëœ Promise)
*/

// Promise is a JavaScript object for asynchronous operation.
// ë¹„ë™ê¸°ì ì¸ ê²ƒì„ ìˆ˜í–‰í•  ë•Œ callback í•¨ìˆ˜ ëŒ€ì‹  ìœ ìš©í•˜ê²Œ ì“¸ ìˆ˜ ìˆëŠ” objectì´ë‹¤!

/*
1. state(ìƒíƒœ) : í”„ë¡œì„¸ìŠ¤ê°€ heavyí•œ operationì„ ìˆ˜í–‰ì¤‘ì¸ì§€, ê¸°ëŠ¥ ìˆ˜í–‰ì´ ì™„ë£Œê°€ ë˜ì–´ì„œ ì„±ê³µí–ˆëŠ”ì§€, ì‹¤íŒ¨í–ˆëŠ”ì§€...ìƒíƒœ
2. procducerì™€ consumerì˜ ì°¨ì´
- producer : ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•´ì„œ í•´ë‹¹í•˜ëŠ” ë°ì´í„°, ì •ë³´ë¥¼ ë§Œë“¤ì–´ë‚´ëŠ”, ì œê³µí•˜ëŠ” ì‚¬ëŒ
- consumer : ì œê³µëœ ë°ì´í„°ë¥¼ ì“°ëŠ”, í•„ìš”ë¡œí•˜ëŠ”, ì†Œë¹„í•˜ëŠ” ì‚¬ëŒ

State: pending -> fulfilled or rejected
- pending : promiseê°€ ë§Œë“¤ì–´ì ¸ì„œ ìš°ë¦¬ê°€ ì§€ì •í•œ operationì´ ìˆ˜í–‰ì¤‘ì¼ë•Œ
- fulfilled : operationì„ ì„±ê³µì ìœ¼ë¡œ ëëƒˆì„ ë•Œ(ì™„ë²½í•˜ê²Œ ì™„ë£Œí•œ ìƒíƒœ)
- rejected : íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜, ë„¤íŠ¸ì›Œí¬ì— ë¬¸ì œê°€ ìƒê²¼ì„ ë•Œ
Producer vs Consumer
*/


// 1. Producer
// when new Promise is created, the executor runs automatically.
// (ìƒˆë¡œìš´ í”„ë¡œë¯¸ìŠ¤ê°€ ë§Œë“¤ì–´ì§ˆ ë•, ìš°ë¦¬ê°€ ì „ë‹¬í•œ executor ì½œë°±í•¨ìˆ˜ê°€ ìë™ì ìœ¼ë¡œ ë°”ë¡œ ì‹¤í–‰ëœë‹¤!! ì—¼ë‘ì— ë‘ê³  ì½”ë“œ ì‘ì„±í•  ê²ƒ!)

// ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” Promiseë¥¼ ë§Œë“¤ì–´ë³´ì
const promise = new Promise((resolve, reject) => {
  // doing some heavy work (network, read files)
  /* ë„¤íŠ¸ì›Œí¬ì—ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ê±°ë‚˜, íŒŒì¼ì—ì„œ í° ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ëŠ” ê³¼ì •ì€
  ì‹œê°„ì´ ê½¤ ê±¸ë ¤ì„œ ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ë©´ ë‹¤ìŒ ë¼ì¸ ì½”ë“œê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•„ì„œ 
  ì‹œê°„ì´ ì¢€ ê±¸ë¦¬ëŠ” ì¼ë“¤ì€ promiseë§Œë“¤ì–´ì„œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤!*/
  console.log('doing something...');
  setTimeout(() => {
    resolve('ellie');
    // reject(new Error('no network'));
    /* ê¸°ëŠ¥ì„ ì˜ ìˆ˜í–‰í–ˆì–´, ì„±ê³µì ìœ¼ë¡œ ì˜ í•´ëƒˆë‹¤ë©´ resolveë¼ëŠ” ì½œë°±í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ ëœë‹¤
    ë°ì´í„°ë¥¼ ë°›ì•„ì™”ëŠ”ë° ì‚¬ìš©ìì˜ ì´ë¦„ì€ ellieì—ˆì–´ ë¼ê³  ì„±ê³µì ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ì—ì„œ ë°›ì•„ì˜¨,
    ë˜ëŠ” íŒŒì¼ì—ì„œ ì½ì–´ì˜¨, ê·¸ë¦¬ê³  ê·¸ê²ƒë“¤ì„ ê°€ê³µí•œ ë°ì´í„°ë¥¼ resolveë¼ëŠ” ì½œë°±í•¨ìˆ˜ë¥¼ í†µí•´ ì „ë‹¬í•˜ë©´ ëœë‹¤! 
    ì´ PromiseëŠ” ì–´ë–¤ ì¼ì„ 2ì´ˆ ì •ë„ ë¬´ì–¸ê°€ë¥¼ í•˜ë‹¤ê°€, ê²°êµ­ì—” ì´ë¥¼ ì˜ ë§ˆë¬´ë¦¬í•´ì„œ resolveë¼ëŠ” ì½œë°±í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ì„œ
    ellieë¼ëŠ” ê°’ì„ ì „ë‹¬í•´ì£¼ëŠ” promiseì´ë‹¤.
    
    ë§Œì•½ ë„¤íŠ¸ì›Œí¬ë¥¼ í•˜ë‹¤ê°€ ë¬´ì–¸ê°€ ì‹¤íŒ¨í–ˆë‹¤ê³  í•´ë³´ì. rejectë¥¼ í˜¸ì¶œí•  ê±´ë°, 
    rejectëŠ” ë³´í†µ Errorë¼ëŠ” objectë¥¼ í†µí•´ ê°’ì„ ì „ë‹¬í•œë‹¤. Errorë¼ëŠ” í´ë˜ìŠ¤ëŠ” JSì—ì„œ ì œê³µí•˜ëŠ”
    object ì¤‘ì˜ í•˜ë‚˜ë¡œ, ë¬´ì–¸ê°€ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤ëŠ” ê±¸ ë‚˜íƒ€ë‚´ëŠ” objectë‹¤.
    Error objectì—ëŠ” ì–´ë–¤ ì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ì§€ ì´ìœ ë¥¼ ì˜ ëª…ì‹œí•´ì„œ ì‘ì„±í•´ì•¼ í•œë‹¤.
    */ 
  }, 2000);
  // promise ì•ˆì—ì„œ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ í•˜ëŠ” ê²ƒì²˜ëŸ¼ setTimeoutì„ ì´ìš©í•´ ì‹œê°„ì˜ delayë¥¼ ì¤˜ë³´ì
}) ;
/* promiseëŠ” classì´ë¯€ë¡œ newë¼ëŠ” í‚¤ì›Œë“œë¥¼ ì´ìš©í•´ì„œ objectë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤
promise ìƒì„±ìë³´ë©´ executorë¼ëŠ” ì½œë°±í•¨ìˆ˜ë¥¼ ì „ë‹¬í•´ì£¼ì–´ì•¼ í•œë‹¤
ì½œë°±í•¨ìˆ˜ì—ëŠ” ë˜ë‹¤ë¥¸ 2ê°€ì§€ ì½œë°±í•¨ìˆ˜ë¥¼ ë°›ëŠ”ë‹¤ 
- resolve(ê¸°ëŠ¥ì„ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í•´ì„œ ë§ˆì§€ë§‰ì— ìµœì¢…ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ì½œë°±í•¨ìˆ˜)
- reject(ê¸°ëŠ¥ ìˆ˜í–‰ì¤‘ ë¬¸ì œê°€ ìƒê¸°ë©´ í˜¸ì¶œí•˜ê²Œ ë  ì½œë°±í•¨ìˆ˜)
*/

/* 
promiseë¥¼ ë§Œë“œëŠ” ìˆœê°„ ìš°ë¦¬ê°€ ì „ë‹¬í•œ executorë¼ëŠ” ì½œë°±í•¨ìˆ˜ê°€ ë°”ë¡œ ì‹¤í–‰ëœë‹¤.
ë§Œì•½ promiseì•ˆì— network í†µì‹ í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í–ˆë‹¤ë©´ promiseê°€ ë§Œë“¤ì–´ì§€ëŠ” ìˆœê°„
ë°”ë¡œ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ ìˆ˜í–‰í•˜ê²Œ ëœë‹¤.
1. ë§Œì•½, ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ì‚¬ìš©ìê°€ ìš”êµ¬í–ˆì„ ë•Œë§Œ í•´ì•¼í•˜ëŠ” ê²½ìš°ë¼ë©´ ì¦‰ ì‚¬ìš©ìê°€ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ
ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ í•´ì•¼í•˜ëŠ” ê²½ìš°ë¼ë©´, ì´ëŸ° ì‹ìœ¼ë¡œ ì‘ì„±í•˜ë©´ ì‚¬ìš©ìê°€ ìš”êµ¬í•˜ì§€ë„ ì•Šì•˜ëŠ”ë°
ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì´ ì¼ì–´ë‚  ìˆ˜ ìˆë‹¤.
ê·¸ë˜ì„œ promiseë¥¼ ë§Œë“œëŠ” ìˆœê°„ ê·¸ ì•ˆì— ì „ë‹¬í•œ executor ì½œë°±í•¨ìˆ˜ê°€ ë°”ë¡œ ì‹¤í–‰ë˜ë¯€ë¡œ ì´ ì ì„ ìœ ì˜í•´ì•¼ í•œë‹¤!
ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ í•˜ê²Œ ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìœ ì˜í•˜ì!
*/


// Promise ì‚¬ìš©í•˜ê¸°
// 2. Comsumers: then, catch, finally

// then: promiseê°€ ì •ìƒì ìœ¼ë¡œ ì˜ ìˆ˜í–‰ëœë‹¤ë©´, ê°’ì„ ë°›ì•„ì™€ì„œ ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” ì½œë°±í•¨ìˆ˜ë¥¼ ì „ë‹¬í•´ì¤€ë‹¤
// value íŒŒë¼ë¯¸í„°: promiseê°€ ì˜ ìˆ˜í–‰ë˜ì–´ì„œ ë§ˆì§€ë§‰ìœ¼ë¡œ resolve ì½œë°±í•¨ìˆ˜ì—ì„œ ì „ë‹¬ëœ ellieë¼ëŠ” ê°’ì´ ì „ë‹¬ëœë‹¤ 
promise
  .then((value) => {
    console.log(value) // 2ì´ˆ í›„ ellie ì¶œë ¥
  })
  .catch(error => {
    console.log(error);
  })
  .finally(() => { 
    console.log('finally');
  })

  
  // 3. Promise chaining
  const fetchNumber = new Promise((resolve, reject) => {
    setTimeout(() => resolve(1), 1000);
  })

  fetchNumber
  .then(num => num * 2)
  .then(num => num * 3)
  .then(num => {
    return new Promise((resolve, reject) => {
      setTimeout(() => resolve(num - 1), 1000);
    });
  })
  .then(num => console.log(num));

  // thenì€ ê°’ì„ ë°”ë¡œ ì „ë‹¬í•  ìˆ˜ë„ ìˆê³ , ì•„ë‹ˆë©´ (ë˜ ë‹¤ë¥¸ ë¹„ë™ê¸°ì¸) promiseë¥¼ ì „ë‹¬í•´ë„ ëœë‹¤!
  

// 4. Error Handling ì˜¤ë¥˜ë¥¼ ì˜ ì²˜ë¦¬í•˜ì
const getHen = () =>
  new Promise((resolve, reject) => {
    setTimeout(() => resolve('ğŸ”'), 1000); // 1ì´ˆ í›„ ë‹­ì„ ë¦¬í„´
  });

const getEgg = hen =>
  new Promise((resolve, reject) => {
    setTimeout(() => reject(new Error(`error! ${hen} => ğŸ¥š`)), 1000); // henì„ ë°›ì•„ì„œ ë‹­ìœ¼ë¡œë¶€í„° ë‹¬ê±€ì„ ì–»ì–´ì˜¤ëŠ” promiseë¥¼ ë¦¬í„´
  });

const chick = egg =>
  new Promise((resolve, reject) => {
    setTimeout(() => resolve(`${egg} => ğŸ¤`), 1000); // ë‹¬ê±€ì„ ë°›ì•„ì™€ì„œ ë³‘ì•„ë¦¬ê°€ ë‚˜ì˜¤ëŠ” í•¨ìˆ˜
  });

  /*
  getHen()
  .then(hen => getEgg(hen))
  .then(egg => chick(egg))
  .then(bird => console.log(bird));

  ì½”ë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì¢€ ë” ê¹”ë”í•˜ê²Œ ë°”ê¿€ ìˆ˜ ìˆë‹¤!
  ì½œë°±í•¨ìˆ˜ë¥¼ ì „ë‹¬í• ë•Œ ë°›ì•„ì˜¤ëŠ” valueë¥¼ ë‹¤ë¥¸ í•¨ìˆ˜ë¡œ ë°”ë¡œ í•˜ë‚˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²½ìš°ì—ëŠ”
  ìƒëµì´ ê°€ëŠ¥í•˜ë‹¤. í•œê°€ì§€ë§Œ 
  */

  getHen()
    .then(getEgg) // ìë™ì ìœ¼ë¡œ thenì—ì„œ ë°›ì•„ì˜¤ëŠ” valueë¥¼ ë°”ë¡œ getEggë¼ëŠ” í•¨ìˆ˜ì— ì•”ë¬µì ìœ¼ë¡œ ì „ë‹¬í•´ì„œ í˜¸ì¶œí•´ì¤€ë‹¤
    .catch(error => {
      return 'ğŸ¥–';
    }) // getEggëŠ” ì‹¤íŒ¨í–ˆì§€ë§Œ ë¹µì„ ëŒ€ì‹  ì „ë‹¬í•´ì£¼ì—ˆê¸° ë•Œë¬¸ì— promise chainì´ ì‹¤íŒ¨í•˜ì§€ ì•Šê³  ë§ˆì§€ë§‰ê¹Œì§€ ì™„ì„±ë¨ -> ê·¸ë˜ì„œ ì—¬ê¸°ì„œ ë°œìƒí•œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ê³  ì‹¶ì„ ë• ë°”ë¡œ ë‹¤ìŒì— catch ì‘ì„±í•´ì„œ ë¬¸ì œ í•´ê²°!
    .then(chick)
    .then(console.log)
    .catch(console.log);


// 5. callback hell -> promise ì´ìš©í•´ ì‘ì„±í•´ë³´ì
// callback-to-promise íŒŒì¼ì—ì„œ~!